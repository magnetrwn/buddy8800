<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>buddy8800: Buddy8800 &ndash; An Altair 8800 S-100 Emulator</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">buddy8800
   </div>
   <div id="projectbrief">An Altair 8800 S-100 emulator that can run CP/M through a serial PTY.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Buddy8800 &ndash; An Altair 8800 S-100 Emulator </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a> <b>An Intel 8080 emulated on an S-100 bus with a Motorola 6850 ACIA serial expansion card. Designed for running BASIC and CP/M over a PTY.</b></p>
<p><img src="cpudiag-in-a-loop.gif" alt="" class="inline" title="Running `cpudiag.bin`"/></p>
<h2><a class="anchor" id="autotoc_md1"></a>
Getting Started</h2>
<ul>
<li><b><a href="https://magnetrwn.github.io/buddy8800">Doxygen Documentation</a></b></li>
<li><a href="#building">Building</a></li>
<li><a href="#running-from-cli">Running from CLI</a></li>
<li><a href="#configuration-file">Configuration File</a></li>
<li><a href="#resources-and-documentation">Resources and Documentation</a></li>
<li><a href="#screenshots">Screenshots</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md2"></a>
Doxygen Documentation</h2>
<p>You can view the <a href="https://magnetrwn.github.io/buddy8800">Doxygen documentation</a>, which includes this README but much more descriptive content.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
Building</h2>
<ul>
<li>Make sure you have installed CMake on your system.</li>
<li>Clone the repository and navigate to the root directory.</li>
<li>Run <code>git submodule update --init --recursive</code> to fetch <code>Catch2</code> (v3) and <code>toml11</code>.</li>
<li>Run <code>./build.sh</code> from the root directory. Some flags are listed next.</li>
<li>The final executable will be placed in the <code>bin/</code> directory.</li>
</ul>
<p>By default, the build script will output a release build that has no tracing and with high optimization. To customize this behavior, some flags are available:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Short&#160;Flag   </th><th class="markdownTableHeadNone">Long&#160;Flag   </th><th class="markdownTableHeadNone">Action   </th><th class="markdownTableHeadNone">Default    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>-d</code>   </td><td class="markdownTableBodyNone"><code>--debug</code>   </td><td class="markdownTableBodyNone">Output a debug build, keeping symbol labels and disabling optimization   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>-r</code>   </td><td class="markdownTableBodyNone"><code>--release</code>   </td><td class="markdownTableBodyNone">Output a release build, enabling optimization   </td><td class="markdownTableBodyNone">Enabled    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"><code>--trace</code>   </td><td class="markdownTableBodyNone">Enable tracing, outputting information about the emulator's state after each instruction   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"><code>--trace-essential</code>   </td><td class="markdownTableBodyNone">Enable tracing only for the listing of executed instructions, not the full state   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>-T</code>   </td><td class="markdownTableBodyNone"><code>--tests</code>   </td><td class="markdownTableBodyNone">Build with tests enabled, compiling and running the Catch2 tests through CTest   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>-P</code>   </td><td class="markdownTableBodyNone"><code>--perf-stat</code>   </td><td class="markdownTableBodyNone">Run performance metrics at the end of the build, then show the results.   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"><code>--perf-report</code>   </td><td class="markdownTableBodyNone">Run performance metrics and let the user browse detailed results.   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>-V</code>   </td><td class="markdownTableBodyNone"><code>--memcheck</code>   </td><td class="markdownTableBodyNone">Run Valgrind's Memcheck tool on the final executable.   </td><td class="markdownTableBodyNone"></td></tr>
</table>
<p>Development builds are usually compiled with <code>./build.sh -d -T</code>.</p>
<p><b>Note:</b> Make sure you have <code>config.toml</code> placed in the same directory as the final executable. This file contains the configuration for the emulator, such as what cards to place and where.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
Running from CLI</h2>
<p>You can either call the emulator from CLI passing pairs of file locations for ROMs and their load addresses, or set these loads directly in the configuration file for a more permanent solution. While you can load from the CLI, the config file will still need to contain information about what cards the system is setup with, in fact you could load these ROMs' data into address ranges belonging to any memory device in the system (not I/O since it belongs to a separate address space where an I/O request signal is detected).</p>
<div class="fragment"><div class="line">bin/buddy8800 your/path/to/rom100.bin 0x100 your/path/to/rom7F00.bin 0x7F00 ...</div>
</div><!-- fragment --><p>Is equivalent (see <b>Note</b>) to:</p>
<div class="fragment"><div class="line">[emulator]</div>
<div class="line">...</div>
<div class="line">start_with_pc_at    = 0x0100</div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">[[card]]</div>
<div class="line">slot        = 3</div>
<div class="line">type        = &quot;rom&quot;</div>
<div class="line">at          = 0x0100</div>
<div class="line">load        = &quot;your/path/to/rom100.bin&quot;</div>
<div class="line"> </div>
<div class="line">[[card]]</div>
<div class="line">slot        = 4</div>
<div class="line">type        = &quot;rom&quot;</div>
<div class="line">at          = 0x7F00</div>
<div class="line">load        = &quot;your/path/to/rom7F00.bin&quot;</div>
</div><!-- fragment --><p><b>Note:</b> The first pair of ROM and address provided by the CLI will generate a few reset vector instruction in the zero page to jump to the first loaded ROM. The config file allows you to specify the starting address for the program counter, which is <b>not the same as the reset vector</b> as it directly sets PC to the specified address, skipping the reset vector. Because of this, be wary of having a value in the config file when trying to load a ROM from the CLI, as the emulator will give priority to the config file provided PC value.</p>
<p>For loading from CLI, the size (<code>range</code>) of the data cards must be determined in the config file, while if using the <code>load</code> field in the config file, the size will be determined by the size of the binary to load. Here is an example of specifying <code>range</code> and not <code>load</code>, while using the CLI to load the data:</p>
<div class="fragment"><div class="line">[[card]]</div>
<div class="line">slot        = 10</div>
<div class="line">type        = &quot;rom&quot;</div>
<div class="line">at          = 0x0100</div>
<div class="line">range       = 2048</div>
</div><!-- fragment --><div class="fragment"><div class="line">bin/buddy8800 your/path/to/rom100.bin 0x100</div>
</div><!-- fragment --><p>Note that this will not check if the binary file is too large for the specified range, and in which case will just continue writing to other cards in the system, which is expected behavior. The CLI loading utility allows you to load data in any range of memory as it serves exactly that purpose, even after having loaded a file already from a config file.</p>
<p>Much of this information is also immediately reported upon running the emulator during setup phase, allowing you to quickly see if the loaded configuration is correct.</p>
<h2><a class="anchor" id="autotoc_md5"></a>
Configuration File</h2>
<p>Please check the highly descriptive <a href="static/config.toml">config.toml</a> file for a full list of options and their descriptions. The configuration file is used to specify the system's setup, such as what cards are placed in the system and where, as well as the initial state of the emulator.</p>
<p>For reference, here is a simple test machine setup (only the cards portion of the config file):</p>
<div class="fragment"><div class="line">[[card]] # 88-SIO serial interface</div>
<div class="line">slot        = 10</div>
<div class="line">type        = &quot;serial&quot;</div>
<div class="line">at          = 0x10</div>
<div class="line"> </div>
<div class="line">[[card]] # Diagnostics II expects to be loaded in RAM</div>
<div class="line">slot        = 3</div>
<div class="line">type        = &quot;ram&quot;</div>
<div class="line">at          = 0x0100</div>
<div class="line">load        = &quot;tests/res/diag2.com&quot;</div>
<div class="line"> </div>
<div class="line">[[card]] # Cover all memory space with RAM just in case</div>
<div class="line">slot        = 4</div>
<div class="line">type        = &quot;ram&quot;</div>
<div class="line">at          = 0x0000</div>
<div class="line">range       = 65536</div>
<div class="line">let_collide = true</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md6"></a>
Resources and Documentation</h2>
<p>Here are some of the resources I used to figure out various aspects of this project</p>
<p><b>Overview</b></p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Altair_8800">Wikipedia/Altair 8800</a>, a general overview.</li>
<li><a href="https://www.youtube.com/watch?v=7kf70nhor24">Making an Emulator: Space Invaders on the Intel 8080</a>, while not directly related, this video has in-depth information on handling an Intel 8080 system's memory map and interrupts.</li>
</ul>
<p><b>Intel 8080</b></p>
<p><img src="i8080-public-domain-240w.webp" alt="" class="inline" title="Intel 8080"/></p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Intel_8080">Wikipedia/Intel 8080</a>, general Intel 8080 info, with an unexpectedly good layout for opcodes.</li>
<li><a href="http://www.emulator101.com/">Emulator101</a> and <a href="http://www.emulator101.com/reference/8080-by-opcode.html">Emulator101/Opcode List</a>, a great resource for understanding the basics of emulation, with a comprehensive opcode list.</li>
<li><a href="http://www.emulator101.com/files/cpudiag.bin">Emulator101/cpudiag.bin</a>, a diagnostic program for the Intel 8080, which was used throughout development for testing.</li>
<li><a href="https://github.com/cbeust/space-invade.rs/blob/main/emulator/cpudiag.lst">space-invade.rs/cpudiag.lst</a>, a very useful listing of the assembled <code>cpudiag.bin</code> program.</li>
<li><a href="https://altairclone.com/downloads/manuals/8080%20Programmers%20Manual.pdf">Altair Clone/Programmers Manual</a>, very useful for understanding how opcodes run and patterns in the instruction set.</li>
<li><a href="https://retrocomputing.stackexchange.com/questions/14977/auxiliary-carry-and-the-intel-8080s-logical-instructions">Auxiliary Carry and the Intel 8080's logical instructions</a>, a very specific question that fixed diagnostics failing and is not very easy to find.</li>
<li><a href="https://stackoverflow.com/questions/2165914/how-do-interrupts-work-on-the-intel-8080">How do interrupts work on the Intel 8080?</a>.</li>
</ul>
<p><b>Altair 8800</b></p>
<p><img src="altair-wikipedia-public-domain-360w.webp" alt="" class="inline" title="Altair 8800B"/></p>
<ul>
<li><a href="http://www.s100computers.com/index.html">S100Computers</a>, a comprehensive collection of hardware information on S-100 systems.</li>
<li><a href="https://retrocomputing.stackexchange.com/questions/14675/what-additional-hardware-was-required-for-basic-on-an-altair-8800">What additional hardware was required for BASIC on an Altair 8800</a>, a very nice explanation of how Altair 8800 systems originally shipped.</li>
<li><a href="https://retrocomputing.stackexchange.com/questions/24117/why-18-expansion-slots-on-the-altair-8800">Why 18 expansion slots on the Altair 8800?</a>.</li>
<li><a href="https://retrocomputing.stackexchange.com/questions/6849/intel-8080-and-altair-8800-256-i-o-ports-but-only-7-free-rst-interrupt-subrou?rq=1">Intel 8080 and Altair 8800. 256 I/O ports, but only 7 free RST (interrupt subroutines) â€” how does it work?</a>, a good explanation of how the Altair 8800's I/O ports and interrupts work.</li>
</ul>
<p><b>Motorola 6850 ACIA</b></p>
<p><img src="mc6850-public-domain-240w.webp" alt="" class="inline" title="Motorola 6850 ACIA"/></p>
<ul>
<li><a href="https://ocw.ump.edu.my/pluginfile.php/423/mod_resource/content/1/Chapter%2013.pdf">This Slide</a> provides a general overview in a neat format, but not very in-depth.</li>
<li><a href="https://www.cpcwiki.eu/imgs/3/3f/MC6850.pdf">Motorola 6850 ACIA Datasheet</a>, the original datasheet for the Motorola 6850 ACIA.</li>
<li><a href="http://beyondbrown.d-bug.me/post/motorola-mc6850-acia/">Motorola 6850 ACIA</a>, a partial OCR of the datasheet.</li>
</ul>
<p><b>CP/M</b></p>
<ul>
<li><a href="https://retrocomputing.stackexchange.com/questions/6442/why-did-cp-m-require-ram-in-the-bottom-part-of-the-address-space">Why did CP/M require RAM in the bottom part of the address space</a> as well as <a href="https://retrocomputing.stackexchange.com/questions/9361/test-emulated-8080-cpu-without-an-os">Test emulated 8080 CPU without an OS</a>, some good information on CP/M memory maps and execution.</li>
</ul>
<p><b>Software</b></p>
<ul>
<li><a href="https://github.com/skx/cpm-dist">skx/cpm-dist</a>, some very cool software for CP/M.</li>
<li><a href="https://github.com/jefftranter/8080">jefftranter/8080</a>, more software, multiple monitor programs.</li>
<li><a href="https://github.com/beriddle/i8080">beriddle/i8080</a>, some demos for the Orion-128 Russian 8080 clone machine, but includes an interesting <a href="https://github.com/beriddle/i8080/tree/master/FP16">16 bit floating point library</a>.</li>
<li><a href="https://github.com/skx/cpmulator/tree/master/ccp">skx/cpmulator</a>, useful CCP sources and binaries.</li>
</ul>
<p>And thank you to the <b>Emulator Development</b> and <b>Lazy Developers</b> Discord servers for general help and support!</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Screenshots</h2>
<p><b>First Contact!</b></p>
<p><img src="cpu-is-operational.png" alt="" class="inline" title="The first time the 8080 diagnostics ran to the end!"/> </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
